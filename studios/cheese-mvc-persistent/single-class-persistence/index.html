<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Studio: Cheese MVC Persistent :: Unit 3: Back-End Java Skill Track</title>

        <link rel="stylesheet" href="http://kevinstock.github.io/css/bootstrap.min.css">
        <link rel="stylesheet" href="http://kevinstock.github.io/css/highlight.launchcode.css">
        <link rel="stylesheet" href="http://kevinstock.github.io/css/main.css">
        <link rel="stylesheet" href="https://djwbyvgln9kts.cloudfront.net/launch_ed_style/custom.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <ul class="nav navbar-nav">

                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle glyphicon glyphicon-menu-hamburger" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>
                        <ul class="dropdown-menu">
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/classes/">
                                        Classes
                                    </a>
                                </li>
                                                            <li class="active lc-button">
                                    <a href="http://kevinstock.github.io/studios/">
                                        Studios
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/assignments/">
                                        Assignments
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/videos/">
                                        Videos
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/resources/">
                                        Resources
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/java4python/">
                                        Java for Python Programmers
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/glossary/">
                                        Glossary
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/about/">
                                        About This Unit
                                    </a>
                                </li>
                                                            <li class=" lc-button">
                                    <a href="http://kevinstock.github.io/issues/">
                                        Reporting Issues
                                    </a>
                                </li>
                                                        <li role="separator" class="divider"></li>
                            <li>
                                <a href="#modalSearch" data-toggle="modal" data-target="#modalSearch">Search This Site</a>
                            </li>
                        </ul>
                    </li>

                
            </ul>

            <div>
                <a class="navbar-brand site-title navbar-center" href="http://kevinstock.github.io/">
                    <h1>Unit 3: Back-End Java Skill Track</h1>
                </a>
            </div>

            <div class="nav navbar-nav navbar-right">
                <a class="navbar-brand dabomb" href="http://kevinstock.github.io/"></a>
            </div>

        </header>

        <!-- Search Modal -->
        <div id="modalSearch" class="modal fade" role="dialog">
           <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                   <button type="button" class="close" data-dismiss="modal">&times;</button>
                   <h4 class="modal-title">Search Unit 3: Back-End Java Skill Track</h4>
                </div>
                <div class="modal-body">
                    <script>
                      (function() {
                        var cx = "014657181352409571810:sq_rqxppnji";
                        var gcse = document.createElement('script');
                        gcse.type = 'text/javascript';
                        gcse.async = true;
                        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                        var s = document.getElementsByTagName('script')[0];
                        s.parentNode.insertBefore(gcse, s);
                      })();
                    </script>
                    <gcse:search></gcse:search>
                </div>
                <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

           </div>
        </div>

        <main class="container-fluid">
            <div class="row">

                <section id="content" class="col-sm-offset-2 col-sm-8">
                                        <h1>Studio: Cheese MVC Persistent</h1>
                    <h2 id="part-1-persisting-a-single-class">Part 1: Persisting a Single Class</h2>
<p>Be sure you've completed the <a href="../">setup steps</a> before starting these tasks.</p>
<p>If you get stuck on any of the steps here refer to the video lesson, or other code within the program that was provided. You'll often find the answers there.</p>
<h2 id="setting-up-the-new-model">Setting Up the New Model</h2>
<p>We'll use Spring Data -- along with JPA and Hibernate -- to create an object-relational mapping for a new class.</p>
<p>In <code>org.launchcode.models</code>, create a new model class named <code>Category</code>. Add the <code>@Entity</code> annotation to make the class persistent In other words, this annotation will ensure that the class is mapped to a relational database table.</p>
<p>Give it a private <code>id</code> field that's an <code>int</code>, along with a private <code>name</code> property that's a string. Add a public getter and setter for <code>name</code>, but only a getter for <code>id</code>. Other classes shouldn't be able to change our ID!</p>
<p>Mimic the same JPA annotations used in <code>Cheese</code>:</p>
<pre><code class="language-java">@Id
@GeneratedValue
private int id;

@NotNull
@Size(min=3, max=15)
private String name;</code></pre>
<p>Add two constructors to <code>Category</code>.</p>
<ul>
<li>Default (no-argument) constructor: This is required, and doesn't need a any code within its body. It will only be used by Hibernate in the process of creating objects from data retrieved from the database.</li>
<li>A constructor that accepts a parameter to set <code>name</code>.</li>
</ul>
<h2 id="setting-up-the-new-dao">Setting Up the New DAO</h2>
<p>We'll want instances of this class to be stored in the database, so create a new interface in <code>org.launchcode.models.data</code> named <code>CategoryDao</code>. You can do this by creating a new class, and then changing <code>class</code> to <code>interface</code> in the boilerplate code. It should extend <code>CrudRepository</code> and have <code>@Repository</code> and <code>@Transactional</code> annotations, as shown here:</p>
<pre><code class="language-java">@Repository
@Transactional
public interface CategoryDao extends CrudRepository&lt;Category, Integer&gt; {
}</code></pre>
<h2 id="adding-categories">Adding Categories</h2>
<p>Create a <code>CategoryController</code> in <code>org.launchcode.controllers</code>. Add the <code>@Controller</code> and <code>@RequestMapping("category")</code> annotations to the class. Just inside the class, add:</p>
<pre><code class="language-java">@Autowired
private CategoryDao categoryDao;</code></pre>
<p>This creates a private field <code>categoryDao</code> of type <code>CategoryDao</code>. This object will be the mechanism with which we interact with objects stored in the database. Recall that Spring will do the work of creating a class that implements <code>CategoryDao</code> and putting one of those objects in the <code>categoryDao</code> field when the application starts up. And all of this is thanks to the <code>@Autowired</code> annotation.</p>
<p>This code would need to be added to each controller class that you want to have access to the persistent collections defined within <code>categoryDao</code>.</p>
<aside class="aside-warning">
<p>We made the <code>@Autowired</code> annotation sound pretty dang magical! It's not that it isn't, but don't go adding <code>@Autowired</code> to every field under the sun that you want to us and expect them to be initialized for you.</p>
<p>Recall that <code>@Autowired</code> is part of Spring's dependency injection framework, and it works its magic in this case because we're using Spring's <code>CrudRepository</code> interface, along with the <code>@Repository</code> annotations, and some other implicit Spring Boot settings.</p>
</aside>
<h3 id="view-all-categories">View All Categories</h3>
<p>Create an <code>index</code> handler within <code>CategoryController</code>. Create an <code>index.html</code> template file in <code>resources/templates/category/</code> (you will have to create this last folder).</p>
<p>The <code>index</code> handler should correspond to the route <code>""</code> (that is, the path <code>/category</code>), and it should retrieve the list of all categories. This is done via the <code>categoryDao</code> object: <code>categoryDao.findAll()</code> returns a collection (actually, an <code>Iterable</code>) of all <code>Category</code> objects managed by <code>categoryDao</code>. Use this snippet to retrieve the list of categories, and then pass the list into the view by adding it to <code>model</code>. Also add a <code>"title"</code> to the model (&quot;Categories&quot; works).</p>
<p>The handler should render the <code>index.html</code> template that you just created. This view should display an unordered list (that is, a <code>&lt;ul&gt;</code>) of category names. The list will look a bit plain for now, but we will make it more interesting later on.</p>
<h3 id="add-categories">Add Categories</h3>
<p>Next, we want to enable the user to create a new category via a form. This will require multiple steps.</p>
<h4 id="add-handler-methods">Add Handler Methods</h4>
<p>Let's add controller handlers to render and process the form.</p>
<p>Create an <code>add</code> handler within <code>CategoryController</code> with input parameter <code>Model model</code>. It should create a new <code>Category</code> object using the default constructor and pass it into the view with key <code>"category"</code> (you can do this with the shorthand <code>model.addAttribute(new Category())</code>; note the omission of a string/key argument). Add the title &quot;Add Category&quot; to <code>model</code> as well.</p>
<p>The <code>index</code> handler should accept <code>GET</code> requests at <code>/category/add</code> (recall that you set the path segment &quot;category&quot; at the controller level already). The handler should render the <code>category/add</code> template (we'll add this template in a moment).</p>
<p>Create another <code>add</code> handler that accepts <code>POST</code> requests at <code>/category/add</code>. Its signature should be:</p>
<pre><code class="language-java">public String add(Model model,
    @ModelAttribute @Valid Category category, Errors errors)</code></pre>
<p>Within this second <code>add</code> handler:</p>
<ul>
<li>Determine whether or not there are any validation errors. If there are, return the form at <code>category/add</code>.</li>
<li>If the form submission is valid:
<ul>
<li>Save the new <code>Category</code> object by calling <code>categoryDao.save(category)</code>.</li>
<li>Redirect to the <code>index</code> handler for <code>CategoryController</code> by returning the string <code>"redirect:"</code>.</li>
</ul></li>
</ul>
<h4 id="add-view">Add View</h4>
<p>In <code>resources/templates/category/</code> create a new template, <code>add.html</code>. Within the template, create a form that uses the <code>category</code> object that you passed in from the controller.</p>
<p>You'll need to bind the object to the form using <code>th:object="${category}"</code>. And you should use the appropriate attributes within the form: <code>th:for</code>, <code>th:field</code>, <code>th:errors</code>.</p>
<p>This is the same technique we've been using over the last couple of weeks.</p>
<h3 id="adding-navigation-links">Adding Navigation Links</h3>
<p>Let's make it easy to navigate to the new views that we've created.</p>
<p>Within the <code>fragments.html</code> template, add a link to <code>/category</code> to the list of navigation links.</p>
<p>Within the <code>category/index.html</code> template, add a link to <code>/category/add</code> with the text &quot;Add Category&quot;. Place this link below the list.</p>
<h2 id="test">Test!</h2>
<p>Start up your application -- don't forget to start MAMP first -- and try to add a new category!</p>
<p>Click on the <em>Categories</em> navigation link, then on <em>Add Category</em>. Complete the form, and if everything works as expected, you'll see your new category in the list. If everything seems to work -- that is, you are able to submit the form without any errors -- but you don't see your category in the list, here's what you should check:</p>
<ul>
<li>Is there any data in the <code>categories</code> table? Check by going to MAMP and hitting the <em>Open Start Page</em> button, then navigating to <em>Tools &gt; phpMyAdmin</em>. Find the <code>cheese-mvc-data</code> database, and look within the <code>categories</code>. If there isn't any data in the table, you probably forgot to save the category when processing the form.</li>
<li>If there's data in the database, check that you are correctly querying for the list of all categories in <code>CategoryController.index</code>: <code>categoryDao.findAll()</code>.</li>
<li>Ensure you're passing this list into the view, and looping over the list of categories to display them in the page.</li>
</ul>
<p>When everything works, move on to <a href="../one-to-many/">Part 2</a>.</p>
                                    </section>

            </div>
        </main>

        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="http://kevinstock.github.io/js/bootstrap.min.js"></script>
        <script src="http://kevinstock.github.io/js/highlight.pack.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');

                // Syntax highlighting
                hljs.configure({ displayLabels: true });
                hljs.initHighlightingOnLoad();
            });
        </script>

        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

            ga('create', "", 'auto');
            ga('send', 'pageview');

        </script>

    </body>
</html>
